<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
</head>
<body>
    <h1>Welcome, <%= username %></h1>
    <a href="/logout">Logout</a>
    <hr>
    <h2>Chat Room</h2>

    <div id="chat-box" style="border: 1px solid #000; width: 300px; height: 300px; overflow-y: auto;"></div>
    <input type="text" id="chat-input" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>

    <script>
        const wsUrl = window.location.origin.replace("http", "ws") + "/ws";
        const ws = new WebSocket(wsUrl);

        ws.onopen = () => {
            console.log("✅ WebSocket Connected to:", wsUrl);
            alert("Connected to WebSocket!");
        };

        ws.onerror = (error) => {
            console.error("❌ WebSocket Error:", error);
            alert("WebSocket Error! Check console.");
        };

ws.onmessage = function(event) {
        const chatBox = document.getElementById("chat-box");
        const msg = document.createElement("p");
        msg.textContent = event.data; // Pesan langsung ditampilkan
        chatBox.appendChild(msg);
    };

    function sendMessage() {
        const input = document.getElementById("chat-input");
        if (input.value.trim() !== "") {
            ws.send(JSON.stringify({ username: "<%= username %>", message: input.value }));
            input.value = "";
        }
    }
    </script>
</body>
</html>